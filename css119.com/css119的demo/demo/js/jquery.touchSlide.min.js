/*
@plugName: jquery.touchSlide.js
@company: baidu.com
@author: xudeming208@126.com
@data: 2013-06-22
@blog: http://www.css119.com
@example: 
	$(id).touchSlide({
		//列表框的标签
        ul: "ul",
        //列表标签
        li: "li",
        //图片序列号按钮BOX
        numBox: ".num",
        //数字按钮焦点样式
        cur: "cur",
        //是否需要循环轮播
        isLoop: true,
        //是否自动播放
        isAuto: true,
        //是否启用图片延迟加载，提高网站初次载入的速度
        lazyLoad: false,
        //启用图片延迟加载时，真正图片存贮的属性名称
        imgSrc: "data-src",
        //效果时间
        speed: 500,
        //效果间隔时间
        autoTime: 5000
	});
*/
(function(b){function a(d,e){var c=this;c.wrap=d;c.index=0;c.ul=c.wrap.find(e.ul);c.li=c.ul.find(e.li);c.len=c.li.length;c.liWidth=c.li.outerWidth(true);c.numBox=c.wrap.find(e.numBox);c.isLoop=e.isLoop;c.isAuto=e.isAuto;c.lazyLoad=e.lazyLoad;c.imgSrc=e.imgSrc;c.cur=e.cur;c.speed=e.speed;c.autoTime=e.autoTime;c.timer=null;c.init()}a.prototype={init:function(){var c=this;c.config();c.autoPlay();c.bind()},config:function(){var d=this;for(var c=0;c<d.len;c++){d.numBox.append("<b>"+(c+1)+"</b>")}d.numBoxB=d.numBox.children();d.numBoxB.eq(0).addClass(d.cur);if(d.lazyLoad){for(var e=0;e<d.len;e++){d.li.eq(e).append("<div class='loading-cover'></div>")}}if(d.isLoop){d.ul.width(d.liWidth*(d.len+2));if(d.lazyLoad){d.loadImg(0,function(){d.li.eq(0).clone().appendTo(d.ul);d.loadImg(d.len-1,function(){d.li.eq(d.len-1).clone().appendTo(d.ul);d.ul.children().eq(d.len+1).css({position:"relative",left:-d.liWidth*(d.len+2)})})})}else{d.li.eq(0).clone().appendTo(d.ul);d.li.eq(d.len-1).clone().appendTo(d.ul);d.ul.children().eq(d.len+1).css({position:"relative",left:-d.liWidth*(d.len+2)})}}else{d.lazyLoad&&d.loadImg(0);d.ul.width(d.liWidth*d.len)}},move:function(){var c=this;if(arguments[0]==0){if(!c.isLoop){if(c.index<c.len-1){c.index++}else{clearInterval(c.timer)}}else{c.index++}}else{if(arguments[0]==1){if(!c.isLoop&&c.index>0){c.index--}else{if(c.isLoop){c.index--}}}}c.ul.stop(true,true).animate({left:-c.liWidth*c.index+"px"},c.speed,function(){c.lazyLoad&&c.loadImg(c.index);if(c.index>c.len-1){c.ul.css("left",0);c.index=0}else{if(c.index<0){c.ul.css("left",-c.liWidth*(c.len-1));c.index=c.len-1}}});c.numBoxB.removeClass(c.cur).eq(c.index).addClass(c.cur);if(c.isLoop&&c.index==c.len){c.numBoxB.removeClass(c.cur).eq(0).addClass(c.cur)}},loadImg:function(e,g){var d=this;if(d.lazyLoad){var f=d.li.eq(e).find("img");if(f.attr(d.imgSrc)){var c=new Image();c.src=f.attr(d.imgSrc);c.onload=function(){f.attr("src",c.src);f.removeAttr(d.imgSrc);d.li.eq(e).find(".loading-cover").remove();g&&typeof g=="function"&&g()}}}},autoPlay:function(){var c=this;if(c.isAuto){c.timer=setInterval(function(){c.move(0)},c.autoTime)}},bind:function(){var f=this;var d,c,h,e=null;function g(k){clearInterval(f.timer);e=null;if(!k.touches.length){return}var l=k.touches[0];d=l.pageX;c=l.pageY;h=parseInt(f.ul.css("left"))}function j(l){if(!l.touches.length){return}var n=l.touches[0],k=n.pageX-d,m=n.pageY-c;l.preventDefault();if(Math.abs(k)>Math.abs(m)){if(k<0){e=0;f.ul.css("left",h-Math.abs(k)+"px")}else{e=1;f.ul.css("left",h+Math.abs(k)+"px")}}}function i(k){e==0&&f.move(0);e==1&&f.move(1);f.autoPlay()}f.wrap[0].addEventListener("touchstart",g,false);f.wrap[0].addEventListener("touchmove",j,false);f.wrap[0].addEventListener("touchend",i,false)}};b.fn.touchSlide=function(c){var d=b.extend({},b.fn.touchSlide.defaults,c);this.each(function(){new a(b(this),d)})};b.fn.touchSlide.defaults={ul:"ul",li:"li",numBox:".num",cur:"cur",isLoop:true,isAuto:true,lazyLoad:false,imgSrc:"data-src",speed:150,autoTime:5000}})(jQuery);